import{_ as Ae}from"./@babel-CCbyfPlC.js";import{r as P}from"./react-Cs2JX7qJ.js";import{L as be,a as Rt,R as jt,U as Tt,B as kt,M as At,C as Dt,b as Lt,O as De,P as Le,S as $e,c as we,N as Ft,A as It,W as zt,d as Ht,e as Bt,f as Wt,V as Nt,g as X,h as tt,i as $t,T as Gt,D as qt,j as Ge,k as Vt}from"./three-BIhMsirs.js";import{u as Ut}from"./react-use-measure-pH-4ZkTk.js";import{F as Xt,u as Yt}from"./its-fine-Bzt0OsTB.js";import{R as Zt,c as oe}from"./react-reconciler-BZLBP0l1.js";import{c as Kt}from"./react-dom-CbJP--2K.js";import{G as Fe,D as Jt,M as _e}from"./three-stdlib-8vnMv4dn.js";import{c as Qt}from"./zustand-DHraDAYT.js";import{s as en,p as tn,c as nn}from"./suspend-react-BKIKQNXN.js";function Un(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Xn(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function i(){return this instanceof i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(i){var s=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(n,i,s.get?s:{enumerable:!0,get:function(){return e[i]}})}),n}var nt={exports:{}},rt={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(h,E){var _=h.length;h.push(E);e:for(;0<_;){var x=_-1>>>1,T=h[x];if(0<s(T,E))h[x]=E,h[_]=T,_=x;else break e}}function n(h){return h.length===0?null:h[0]}function i(h){if(h.length===0)return null;var E=h[0],_=h.pop();if(_!==E){h[0]=_;e:for(var x=0,T=h.length,j=T>>>1;x<j;){var W=2*(x+1)-1,$=h[W],V=W+1,J=h[V];if(0>s($,_))V<T&&0>s(J,$)?(h[x]=J,h[V]=_,x=V):(h[x]=$,h[W]=_,x=W);else if(V<T&&0>s(J,_))h[x]=J,h[V]=_,x=V;else break e}}return E}function s(h,E){var _=h.sortIndex-E.sortIndex;return _!==0?_:h.id-E.id}if(typeof performance=="object"&&typeof performance.now=="function"){var f=performance;e.unstable_now=function(){return f.now()}}else{var w=Date,m=w.now();e.unstable_now=function(){return w.now()-m}}var a=[],v=[],r=1,o=null,c=3,d=!1,p=!1,M=!1,y=typeof setTimeout=="function"?setTimeout:null,l=typeof clearTimeout=="function"?clearTimeout:null,u=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function g(h){for(var E=n(v);E!==null;){if(E.callback===null)i(v);else if(E.startTime<=h)i(v),E.sortIndex=E.expirationTime,t(a,E);else break;E=n(v)}}function S(h){if(M=!1,g(h),!p)if(n(a)!==null)p=!0,N(O);else{var E=n(v);E!==null&&H(S,E.startTime-h)}}function O(h,E){p=!1,M&&(M=!1,l(D),D=-1),d=!0;var _=c;try{for(g(E),o=n(a);o!==null&&(!(o.expirationTime>E)||h&&!b());){var x=o.callback;if(typeof x=="function"){o.callback=null,c=o.priorityLevel;var T=x(o.expirationTime<=E);E=e.unstable_now(),typeof T=="function"?o.callback=T:o===n(a)&&i(a),g(E)}else i(a);o=n(a)}if(o!==null)var j=!0;else{var W=n(v);W!==null&&H(S,W.startTime-E),j=!1}return j}finally{o=null,c=_,d=!1}}var C=!1,k=null,D=-1,R=5,L=-1;function b(){return!(e.unstable_now()-L<R)}function A(){if(k!==null){var h=e.unstable_now();L=h;var E=!0;try{E=k(!0,h)}finally{E?B():(C=!1,k=null)}}else C=!1}var B;if(typeof u=="function")B=function(){u(A)};else if(typeof MessageChannel<"u"){var q=new MessageChannel,z=q.port2;q.port1.onmessage=A,B=function(){z.postMessage(null)}}else B=function(){y(A,0)};function N(h){k=h,C||(C=!0,B())}function H(h,E){D=y(function(){h(e.unstable_now())},E)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(h){h.callback=null},e.unstable_continueExecution=function(){p||d||(p=!0,N(O))},e.unstable_forceFrameRate=function(h){0>h||125<h?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<h?Math.floor(1e3/h):5},e.unstable_getCurrentPriorityLevel=function(){return c},e.unstable_getFirstCallbackNode=function(){return n(a)},e.unstable_next=function(h){switch(c){case 1:case 2:case 3:var E=3;break;default:E=c}var _=c;c=E;try{return h()}finally{c=_}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(h,E){switch(h){case 1:case 2:case 3:case 4:case 5:break;default:h=3}var _=c;c=h;try{return E()}finally{c=_}},e.unstable_scheduleCallback=function(h,E,_){var x=e.unstable_now();switch(typeof _=="object"&&_!==null?(_=_.delay,_=typeof _=="number"&&0<_?x+_:x):_=x,h){case 1:var T=-1;break;case 2:T=250;break;case 5:T=1073741823;break;case 4:T=1e4;break;default:T=5e3}return T=_+T,h={id:r++,callback:E,priorityLevel:h,startTime:_,expirationTime:T,sortIndex:-1},_>x?(h.sortIndex=_,t(v,h),n(a)===null&&h===n(v)&&(M?(l(D),D=-1):M=!0,H(S,_-x))):(h.sortIndex=T,t(a,h),p||d||(p=!0,N(O))),h},e.unstable_shouldYield=b,e.unstable_wrapCallback=function(h){var E=c;return function(){var _=c;c=E;try{return h.apply(this,arguments)}finally{c=_}}}})(rt);nt.exports=rt;var qe=nt.exports;const Ie={},rn=e=>void Object.assign(Ie,e);function on(e,t){function n(r,{args:o=[],attach:c,...d},p){let M=`${r[0].toUpperCase()}${r.slice(1)}`,y;if(r==="primitive"){if(d.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const l=d.object;y=ne(l,{type:r,root:p,attach:c,primitive:!0})}else{const l=Ie[M];if(!l)throw new Error(`R3F: ${M} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(o))throw new Error("R3F: The args prop must be an array!");y=ne(new l(...o),{type:r,root:p,attach:c,memoizedProps:{args:o}})}return y.__r3f.attach===void 0&&(y instanceof kt?y.__r3f.attach="geometry":y instanceof At&&(y.__r3f.attach="material")),M!=="inject"&&Ee(y,d),y}function i(r,o){let c=!1;if(o){var d,p;(d=o.__r3f)!=null&&d.attach?Me(r,o,o.__r3f.attach):o.isObject3D&&r.isObject3D&&(r.add(o),c=!0),c||(p=r.__r3f)==null||p.objects.push(o),o.__r3f||ne(o,{}),o.__r3f.parent=r,Te(o),re(o)}}function s(r,o,c){let d=!1;if(o){var p,M;if((p=o.__r3f)!=null&&p.attach)Me(r,o,o.__r3f.attach);else if(o.isObject3D&&r.isObject3D){o.parent=r,o.dispatchEvent({type:"added"}),r.dispatchEvent({type:"childadded",child:o});const y=r.children.filter(u=>u!==o),l=y.indexOf(c);r.children=[...y.slice(0,l),o,...y.slice(l)],d=!0}d||(M=r.__r3f)==null||M.objects.push(o),o.__r3f||ne(o,{}),o.__r3f.parent=r,Te(o),re(o)}}function f(r,o,c=!1){r&&[...r].forEach(d=>w(o,d,c))}function w(r,o,c){if(o){var d,p,M;if(o.__r3f&&(o.__r3f.parent=null),(d=r.__r3f)!=null&&d.objects&&(r.__r3f.objects=r.__r3f.objects.filter(S=>S!==o)),(p=o.__r3f)!=null&&p.attach)Ze(r,o,o.__r3f.attach);else if(o.isObject3D&&r.isObject3D){var y;r.remove(o),(y=o.__r3f)!=null&&y.root&&vn(he(o),o)}const u=(M=o.__r3f)==null?void 0:M.primitive,g=!u&&(c===void 0?o.dispose!==null:c);if(!u){var l;f((l=o.__r3f)==null?void 0:l.objects,o,g),f(o.children,o,g)}if(delete o.__r3f,g&&o.dispose&&o.type!=="Scene"){const S=()=>{try{o.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?qe.unstable_scheduleCallback(qe.unstable_IdlePriority,S):S()}re(r)}}function m(r,o,c,d){var p;const M=(p=r.__r3f)==null?void 0:p.parent;if(!M)return;const y=n(o,c,r.__r3f.root);if(r.children){for(const l of r.children)l.__r3f&&i(y,l);r.children=r.children.filter(l=>!l.__r3f)}r.__r3f.objects.forEach(l=>i(y,l)),r.__r3f.objects=[],r.__r3f.autoRemovedBeforeAppend||w(M,r),y.parent&&(y.__r3f.autoRemovedBeforeAppend=!0),i(M,y),y.raycast&&y.__r3f.eventCount&&he(y).getState().internal.interaction.push(y),[d,d.alternate].forEach(l=>{l!==null&&(l.stateNode=y,l.ref&&(typeof l.ref=="function"?l.ref(y):l.ref.current=y))})}const a=()=>console.warn("Text is not allowed in the R3F tree! This could be stray whitespace or characters.");return{reconciler:Zt({createInstance:n,removeChild:w,appendChild:i,appendInitialChild:i,insertBefore:s,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(r,o)=>{if(!o)return;const c=r.getState().scene;c.__r3f&&(c.__r3f.root=r,i(c,o))},removeChildFromContainer:(r,o)=>{o&&w(r.getState().scene,o)},insertInContainerBefore:(r,o,c)=>{if(!o||!c)return;const d=r.getState().scene;d.__r3f&&s(d,o,c)},getRootHostContext:()=>null,getChildHostContext:r=>r,finalizeInitialChildren(r){var o;return!!((o=r==null?void 0:r.__r3f)!=null?o:{}).handlers},prepareUpdate(r,o,c,d){var p;if(((p=r==null?void 0:r.__r3f)!=null?p:{}).primitive&&d.object&&d.object!==r)return[!0];{const{args:y=[],children:l,...u}=d,{args:g=[],children:S,...O}=c;if(!Array.isArray(y))throw new Error("R3F: the args prop must be an array!");if(y.some((k,D)=>k!==g[D]))return[!0];const C=ut(r,u,O,!0);return C.changes.length?[!1,C]:null}},commitUpdate(r,[o,c],d,p,M,y){o?m(r,d,M,y):Ee(r,c)},commitMount(r,o,c,d){var p;const M=(p=r.__r3f)!=null?p:{};r.raycast&&M.handlers&&M.eventCount&&he(r).getState().internal.interaction.push(r)},getPublicInstance:r=>r,prepareForCommit:()=>null,preparePortalMount:r=>ne(r.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(r){var o;const{attach:c,parent:d}=(o=r.__r3f)!=null?o:{};c&&d&&Ze(d,r,c),r.isObject3D&&(r.visible=!1),re(r)},unhideInstance(r,o){var c;const{attach:d,parent:p}=(c=r.__r3f)!=null?c:{};d&&p&&Me(p,r,d),(r.isObject3D&&o.visible==null||o.visible)&&(r.visible=!0),re(r)},createTextInstance:a,hideTextInstance:a,unhideTextInstance:a,getCurrentEventPriority:()=>t?t():oe.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&I.fun(performance.now)?performance.now:I.fun(Date.now)?Date.now:()=>0,scheduleTimeout:I.fun(setTimeout)?setTimeout:void 0,cancelTimeout:I.fun(clearTimeout)?clearTimeout:void 0}),applyProps:Ee}}var Ve,Ue;const Pe=e=>"colorSpace"in e||"outputColorSpace"in e,ot=()=>{var e;return(e=Ie.ColorManagement)!=null?e:null},it=e=>e&&e.isOrthographicCamera,sn=e=>e&&e.hasOwnProperty("current"),ce=typeof window<"u"&&((Ve=window.document)!=null&&Ve.createElement||((Ue=window.navigator)==null?void 0:Ue.product)==="ReactNative")?P.useLayoutEffect:P.useEffect;function st(e){const t=P.useRef(e);return ce(()=>void(t.current=e),[e]),t}function an({set:e}){return ce(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class at extends P.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}at.getDerivedStateFromError=()=>({error:!0});const lt="__default",Xe=new Map,ln=e=>e&&!!e.memoized&&!!e.changes;function ct(e){var t;const n=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}const ae=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()};function he(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const I={obj:e=>e===Object(e)&&!I.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:n="shallow",objects:i="reference",strict:s=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(I.str(e)||I.num(e))return e===t;const f=I.obj(e);if(f&&i==="reference")return e===t;const w=I.arr(e);if(w&&n==="reference")return e===t;if((w||f)&&e===t)return!0;let m;for(m in e)if(!(m in t))return!1;if(f&&n==="shallow"&&i==="shallow"){for(m in s?t:e)if(!I.equ(e[m],t[m],{strict:s,objects:"reference"}))return!1}else for(m in s?t:e)if(e[m]!==t[m])return!1;if(I.und(m)){if(w&&e.length===0&&t.length===0||f&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function cn(e){const t={nodes:{},materials:{}};return e&&e.traverse(n=>{n.name&&(t.nodes[n.name]=n),n.material&&!t.materials[n.material.name]&&(t.materials[n.material.name]=n.material)}),t}function un(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function ne(e,t){const n=e;return n.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function je(e,t){let n=e;if(t.includes("-")){const i=t.split("-"),s=i.pop();return n=i.reduce((f,w)=>f[w],e),{target:n,key:s}}else return{target:n,key:t}}const Ye=/-\d+$/;function Me(e,t,n){if(I.str(n)){if(Ye.test(n)){const f=n.replace(Ye,""),{target:w,key:m}=je(e,f);Array.isArray(w[m])||(w[m]=[])}const{target:i,key:s}=je(e,n);t.__r3f.previousAttach=i[s],i[s]=t}else t.__r3f.previousAttach=n(e,t)}function Ze(e,t,n){var i,s;if(I.str(n)){const{target:f,key:w}=je(e,n),m=t.__r3f.previousAttach;m===void 0?delete f[w]:f[w]=m}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(s=t.__r3f)==null||delete s.previousAttach}function ut(e,{children:t,key:n,ref:i,...s},{children:f,key:w,ref:m,...a}={},v=!1){var r;const o=(r=e==null?void 0:e.__r3f)!=null?r:{},c=Object.entries(s),d=[];if(v){const M=Object.keys(a);for(let y=0;y<M.length;y++)s.hasOwnProperty(M[y])||c.unshift([M[y],lt+"remove"])}c.forEach(([M,y])=>{var l;if((l=e.__r3f)!=null&&l.primitive&&M==="object"||I.equ(y,a[M]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(M))return d.push([M,y,!0,[]]);let u=[];M.includes("-")&&(u=M.split("-")),d.push([M,y,!1,u]);for(const g in s){const S=s[g];g.startsWith(`${M}-`)&&d.push([g,S,!1,g.split("-")])}});const p={...s};return o.memoizedProps&&o.memoizedProps.args&&(p.args=o.memoizedProps.args),o.memoizedProps&&o.memoizedProps.attach&&(p.attach=o.memoizedProps.attach),{memoized:p,changes:d}}const fn=typeof process<"u"&&!1;function Ee(e,t){var n,i,s;const f=(n=e.__r3f)!=null?n:{},w=f.root,m=(i=w==null||w.getState==null?void 0:w.getState())!=null?i:{},{memoized:a,changes:v}=ln(t)?t:ut(e,t),r=f.eventCount;e.__r3f&&(e.__r3f.memoizedProps=a);for(let c=0;c<v.length;c++){let[d,p,M,y]=v[c];if(Pe(e)){const S="srgb",O="srgb-linear";d==="encoding"?(d="colorSpace",p=p===3001?S:O):d==="outputEncoding"&&(d="outputColorSpace",p=p===3001?S:O)}let l=e,u=l[d];if(y.length&&(u=y.reduce((g,S)=>g[S],e),!(u&&u.set))){const[g,...S]=y.reverse();l=S.reverse().reduce((O,C)=>O[C],e),d=g}if(p===lt+"remove")if(l.constructor){let g=Xe.get(l.constructor);g||(g=new l.constructor,Xe.set(l.constructor,g)),p=g[d]}else p=0;if(M)p?f.handlers[d]=p:delete f.handlers[d],f.eventCount=Object.keys(f.handlers).length;else if(u&&u.set&&(u.copy||u instanceof be)){if(Array.isArray(p))u.fromArray?u.fromArray(p):u.set(...p);else if(u.copy&&p&&p.constructor&&(fn?u.constructor.name===p.constructor.name:u.constructor===p.constructor))u.copy(p);else if(p!==void 0){const g=u instanceof Dt;!g&&u.setScalar?u.setScalar(p):u instanceof be&&p instanceof be?u.mask=p.mask:u.set(p),!ot()&&!m.linear&&g&&u.convertSRGBToLinear()}}else if(l[d]=p,l[d]instanceof Rt&&l[d].format===jt&&l[d].type===Tt){const g=l[d];Pe(g)&&Pe(m.gl)?g.colorSpace=m.gl.outputColorSpace:g.encoding=m.gl.outputEncoding}re(e)}if(f.parent&&e.raycast&&r!==f.eventCount){const c=he(e).getState().internal,d=c.interaction.indexOf(e);d>-1&&c.interaction.splice(d,1),f.eventCount&&c.interaction.push(e)}return!(v.length===1&&v[0][0]==="onUpdate")&&v.length&&(s=e.__r3f)!=null&&s.parent&&Te(e),e}function re(e){var t,n;const i=(t=e.__r3f)==null||(n=t.root)==null||n.getState==null?void 0:n.getState();i&&i.internal.frames===0&&i.invalidate()}function Te(e){e.onUpdate==null||e.onUpdate(e)}function dn(e,t){e.manual||(it(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function pe(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function pn(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return oe.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return oe.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return oe.ContinuousEventPriority;default:return oe.DefaultEventPriority}}function ft(e,t,n,i){const s=n.get(t);s&&(n.delete(t),n.size===0&&(e.delete(i),s.target.releasePointerCapture(i)))}function vn(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter(i=>i!==t),n.initialHits=n.initialHits.filter(i=>i!==t),n.hovered.forEach((i,s)=>{(i.eventObject===t||i.object===t)&&n.hovered.delete(s)}),n.capturedMap.forEach((i,s)=>{ft(n.capturedMap,t,i,s)})}function mn(e){function t(a){const{internal:v}=e.getState(),r=a.offsetX-v.initialClick[0],o=a.offsetY-v.initialClick[1];return Math.round(Math.sqrt(r*r+o*o))}function n(a){return a.filter(v=>["Move","Over","Enter","Out","Leave"].some(r=>{var o;return(o=v.__r3f)==null?void 0:o.handlers["onPointer"+r]}))}function i(a,v){const r=e.getState(),o=new Set,c=[],d=v?v(r.internal.interaction):r.internal.interaction;for(let l=0;l<d.length;l++){const u=ae(d[l]);u&&(u.raycaster.camera=void 0)}r.previousRoot||r.events.compute==null||r.events.compute(a,r);function p(l){const u=ae(l);if(!u||!u.events.enabled||u.raycaster.camera===null)return[];if(u.raycaster.camera===void 0){var g;u.events.compute==null||u.events.compute(a,u,(g=u.previousRoot)==null?void 0:g.getState()),u.raycaster.camera===void 0&&(u.raycaster.camera=null)}return u.raycaster.camera?u.raycaster.intersectObject(l,!0):[]}let M=d.flatMap(p).sort((l,u)=>{const g=ae(l.object),S=ae(u.object);return!g||!S?l.distance-u.distance:S.events.priority-g.events.priority||l.distance-u.distance}).filter(l=>{const u=pe(l);return o.has(u)?!1:(o.add(u),!0)});r.events.filter&&(M=r.events.filter(M,r));for(const l of M){let u=l.object;for(;u;){var y;(y=u.__r3f)!=null&&y.eventCount&&c.push({...l,eventObject:u}),u=u.parent}}if("pointerId"in a&&r.internal.capturedMap.has(a.pointerId))for(let l of r.internal.capturedMap.get(a.pointerId).values())o.has(pe(l.intersection))||c.push(l.intersection);return c}function s(a,v,r,o){const c=e.getState();if(a.length){const d={stopped:!1};for(const p of a){const M=ae(p.object)||c,{raycaster:y,pointer:l,camera:u,internal:g}=M,S=new X(l.x,l.y,0).unproject(u),O=L=>{var b,A;return(b=(A=g.capturedMap.get(L))==null?void 0:A.has(p.eventObject))!=null?b:!1},C=L=>{const b={intersection:p,target:v.target};g.capturedMap.has(L)?g.capturedMap.get(L).set(p.eventObject,b):g.capturedMap.set(L,new Map([[p.eventObject,b]])),v.target.setPointerCapture(L)},k=L=>{const b=g.capturedMap.get(L);b&&ft(g.capturedMap,p.eventObject,b,L)};let D={};for(let L in v){let b=v[L];typeof b!="function"&&(D[L]=b)}let R={...p,...D,pointer:l,intersections:a,stopped:d.stopped,delta:r,unprojectedPoint:S,ray:y.ray,camera:u,stopPropagation(){const L="pointerId"in v&&g.capturedMap.get(v.pointerId);if((!L||L.has(p.eventObject))&&(R.stopped=d.stopped=!0,g.hovered.size&&Array.from(g.hovered.values()).find(b=>b.eventObject===p.eventObject))){const b=a.slice(0,a.indexOf(p));f([...b,p])}},target:{hasPointerCapture:O,setPointerCapture:C,releasePointerCapture:k},currentTarget:{hasPointerCapture:O,setPointerCapture:C,releasePointerCapture:k},nativeEvent:v};if(o(R),d.stopped===!0)break}}return a}function f(a){const{internal:v}=e.getState();for(const r of v.hovered.values())if(!a.length||!a.find(o=>o.object===r.object&&o.index===r.index&&o.instanceId===r.instanceId)){const c=r.eventObject.__r3f,d=c==null?void 0:c.handlers;if(v.hovered.delete(pe(r)),c!=null&&c.eventCount){const p={...r,intersections:a};d.onPointerOut==null||d.onPointerOut(p),d.onPointerLeave==null||d.onPointerLeave(p)}}}function w(a,v){for(let r=0;r<v.length;r++){const o=v[r].__r3f;o==null||o.handlers.onPointerMissed==null||o.handlers.onPointerMissed(a)}}function m(a){switch(a){case"onPointerLeave":case"onPointerCancel":return()=>f([]);case"onLostPointerCapture":return v=>{const{internal:r}=e.getState();"pointerId"in v&&r.capturedMap.has(v.pointerId)&&requestAnimationFrame(()=>{r.capturedMap.has(v.pointerId)&&(r.capturedMap.delete(v.pointerId),f([]))})}}return function(r){const{onPointerMissed:o,internal:c}=e.getState();c.lastEvent.current=r;const d=a==="onPointerMove",p=a==="onClick"||a==="onContextMenu"||a==="onDoubleClick",y=i(r,d?n:void 0),l=p?t(r):0;a==="onPointerDown"&&(c.initialClick=[r.offsetX,r.offsetY],c.initialHits=y.map(g=>g.eventObject)),p&&!y.length&&l<=2&&(w(r,c.interaction),o&&o(r)),d&&f(y);function u(g){const S=g.eventObject,O=S.__r3f,C=O==null?void 0:O.handlers;if(O!=null&&O.eventCount)if(d){if(C.onPointerOver||C.onPointerEnter||C.onPointerOut||C.onPointerLeave){const k=pe(g),D=c.hovered.get(k);D?D.stopped&&g.stopPropagation():(c.hovered.set(k,g),C.onPointerOver==null||C.onPointerOver(g),C.onPointerEnter==null||C.onPointerEnter(g))}C.onPointerMove==null||C.onPointerMove(g)}else{const k=C[a];k?(!p||c.initialHits.includes(S))&&(w(r,c.interaction.filter(D=>!c.initialHits.includes(D))),k(g)):p&&c.initialHits.includes(S)&&w(r,c.interaction.filter(D=>!c.initialHits.includes(D)))}}s(y,r,l,u)}}return{handlePointer:m}}const dt=e=>!!(e!=null&&e.render),pt=P.createContext(null),hn=(e,t)=>{const n=Qt((m,a)=>{const v=new X,r=new X,o=new X;function c(l=a().camera,u=r,g=a().size){const{width:S,height:O,top:C,left:k}=g,D=S/O;u instanceof X?o.copy(u):o.set(...u);const R=l.getWorldPosition(v).distanceTo(o);if(it(l))return{width:S/l.zoom,height:O/l.zoom,top:C,left:k,factor:1,distance:R,aspect:D};{const L=l.fov*Math.PI/180,b=2*Math.tan(L/2)*R,A=b*(S/O);return{width:A,height:b,top:C,left:k,factor:S/A,distance:R,aspect:D}}}let d;const p=l=>m(u=>({performance:{...u.performance,current:l}})),M=new tt;return{set:m,get:a,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(l=1)=>e(a(),l),advance:(l,u)=>t(l,u,a()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new $t,pointer:M,mouse:M,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const l=a();d&&clearTimeout(d),l.performance.current!==l.performance.min&&p(l.performance.min),d=setTimeout(()=>p(a().performance.max),l.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:c},setEvents:l=>m(u=>({...u,events:{...u.events,...l}})),setSize:(l,u,g,S,O)=>{const C=a().camera,k={width:l,height:u,top:S||0,left:O||0,updateStyle:g};m(D=>({size:k,viewport:{...D.viewport,...c(C,r,k)}}))},setDpr:l=>m(u=>{const g=ct(l);return{viewport:{...u.viewport,dpr:g,initialDpr:u.viewport.initialDpr||g}}}),setFrameloop:(l="always")=>{const u=a().clock;u.stop(),u.elapsedTime=0,l!=="never"&&(u.start(),u.elapsedTime=0),m(()=>({frameloop:l}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:P.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(l,u,g)=>{const S=a().internal;return S.priority=S.priority+(u>0?1:0),S.subscribers.push({ref:l,priority:u,store:g}),S.subscribers=S.subscribers.sort((O,C)=>O.priority-C.priority),()=>{const O=a().internal;O!=null&&O.subscribers&&(O.priority=O.priority-(u>0?1:0),O.subscribers=O.subscribers.filter(C=>C.ref!==l))}}}}}),i=n.getState();let s=i.size,f=i.viewport.dpr,w=i.camera;return n.subscribe(()=>{const{camera:m,size:a,viewport:v,gl:r,set:o}=n.getState();if(a.width!==s.width||a.height!==s.height||v.dpr!==f){var c;s=a,f=v.dpr,dn(m,a),r.setPixelRatio(v.dpr);const d=(c=a.updateStyle)!=null?c:typeof HTMLCanvasElement<"u"&&r.domElement instanceof HTMLCanvasElement;r.setSize(a.width,a.height,d)}m!==w&&(w=m,o(d=>({viewport:{...d.viewport,...d.viewport.getCurrentViewport(m)}})))}),n.subscribe(m=>e(m)),n};function gn(e,t){const n={callback:e};return t.add(n),()=>void t.delete(n)}let ve,vt=new Set,yn=new Set,bn=new Set;const Yn=e=>gn(e,vt);function Ce(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function le(e,t){switch(e){case"before":return Ce(vt,t);case"after":return Ce(yn,t);case"tail":return Ce(bn,t)}}let Se,xe;function Oe(e,t,n){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Se=t.internal.subscribers,ve=0;ve<Se.length;ve++)xe=Se[ve],xe.ref.current(xe.store.getState(),i,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function wn(e){let t=!1,n=!1,i,s,f;function w(v){s=requestAnimationFrame(w),t=!0,i=0,le("before",v),n=!0;for(const o of e.values()){var r;f=o.store.getState(),f.internal.active&&(f.frameloop==="always"||f.internal.frames>0)&&!((r=f.gl.xr)!=null&&r.isPresenting)&&(i+=Oe(v,f))}if(n=!1,le("after",v),i===0)return le("tail",v),t=!1,cancelAnimationFrame(s)}function m(v,r=1){var o;if(!v)return e.forEach(c=>m(c.store.getState(),r));(o=v.gl.xr)!=null&&o.isPresenting||!v.internal.active||v.frameloop==="never"||(r>1?v.internal.frames=Math.min(60,v.internal.frames+r):n?v.internal.frames=2:v.internal.frames=1,t||(t=!0,requestAnimationFrame(w)))}function a(v,r=!0,o,c){if(r&&le("before",v),o)Oe(v,o,c);else for(const d of e.values())Oe(v,d.store.getState());r&&le("after",v)}return{loop:w,invalidate:m,advance:a}}function mt(){const e=P.useContext(pt);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function _n(e=n=>n,t){return mt()(e,t)}function ht(e,t=0){const n=mt(),i=n.getState().internal.subscribe,s=st(e);return ce(()=>i(s,t,n),[t,i,n]),null}const Ke=new WeakMap;function gt(e,t){return function(n,...i){let s=Ke.get(n);return s||(s=new n,Ke.set(n,s)),e&&e(s),Promise.all(i.map(f=>new Promise((w,m)=>s.load(f,a=>{a.scene&&Object.assign(a,cn(a.scene)),w(a)},t,a=>m(new Error(`Could not load ${f}: ${a==null?void 0:a.message}`))))))}}function ue(e,t,n,i){const s=Array.isArray(t)?t:[t],f=en(gt(n,i),[e,...s],{equal:I.equ});return Array.isArray(t)?f:f[0]}ue.preload=function(e,t,n){const i=Array.isArray(t)?t:[t];return tn(gt(n),[e,...i])};ue.clear=function(e,t){const n=Array.isArray(t)?t:[t];return nn([e,...n])};const ie=new Map,{invalidate:Je,advance:Qe}=wn(ie),{reconciler:ge,applyProps:ee}=on(ie,pn),te={objects:"shallow",strict:!1},Pn=(e,t)=>{const n=typeof e=="function"?e(t):e;return dt(n)?n:new zt({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Mn(e,t){const n=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:i,height:s,top:f,left:w,updateStyle:m=n}=t;return{width:i,height:s,top:f,left:w,updateStyle:m}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:i,height:s,top:f,left:w}=e.parentElement.getBoundingClientRect();return{width:i,height:s,top:f,left:w,updateStyle:n}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:n};return{width:0,height:0,top:0,left:0}}function En(e){const t=ie.get(e),n=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const s=typeof reportError=="function"?reportError:console.error,f=i||hn(Je,Qe),w=n||ge.createContainer(f,oe.ConcurrentRoot,null,!1,null,"",s,null);t||ie.set(e,{fiber:w,store:f});let m,a=!1,v;return{configure(r={}){let{gl:o,size:c,scene:d,events:p,onCreated:M,shadows:y=!1,linear:l=!1,flat:u=!1,legacy:g=!1,orthographic:S=!1,frameloop:O="always",dpr:C=[1,2],performance:k,raycaster:D,camera:R,onPointerMissed:L}=r,b=f.getState(),A=b.gl;b.gl||b.set({gl:A=Pn(o,e)});let B=b.raycaster;B||b.set({raycaster:B=new Lt});const{params:q,...z}=D||{};if(I.equ(z,B,te)||ee(B,{...z}),I.equ(q,B.params,te)||ee(B,{params:{...B.params,...q}}),!b.camera||b.camera===v&&!I.equ(v,R,te)){v=R;const _=R instanceof Ht,x=_?R:S?new De(0,0,0,0,.1,1e3):new Le(75,0,.1,1e3);_||(x.position.z=5,R&&(ee(x,R),("aspect"in R||"left"in R||"right"in R||"bottom"in R||"top"in R)&&(x.manual=!0,x.updateProjectionMatrix())),!b.camera&&!(R!=null&&R.rotation)&&x.lookAt(0,0,0)),b.set({camera:x}),B.camera=x}if(!b.scene){let _;d instanceof $e?_=d:(_=new $e,d&&ee(_,d)),b.set({scene:ne(_)})}if(!b.xr){var N;const _=(j,W)=>{const $=f.getState();$.frameloop!=="never"&&Qe(j,!0,$,W)},x=()=>{const j=f.getState();j.gl.xr.enabled=j.gl.xr.isPresenting,j.gl.xr.setAnimationLoop(j.gl.xr.isPresenting?_:null),j.gl.xr.isPresenting||Je(j)},T={connect(){const j=f.getState().gl;j.xr.addEventListener("sessionstart",x),j.xr.addEventListener("sessionend",x)},disconnect(){const j=f.getState().gl;j.xr.removeEventListener("sessionstart",x),j.xr.removeEventListener("sessionend",x)}};typeof((N=A.xr)==null?void 0:N.addEventListener)=="function"&&T.connect(),b.set({xr:T})}if(A.shadowMap){const _=A.shadowMap.enabled,x=A.shadowMap.type;if(A.shadowMap.enabled=!!y,I.boo(y))A.shadowMap.type=we;else if(I.str(y)){var H;const T={basic:Bt,percentage:Wt,soft:we,variance:Nt};A.shadowMap.type=(H=T[y])!=null?H:we}else I.obj(y)&&Object.assign(A.shadowMap,y);(_!==A.shadowMap.enabled||x!==A.shadowMap.type)&&(A.shadowMap.needsUpdate=!0)}const h=ot();h&&("enabled"in h?h.enabled=!g:"legacyMode"in h&&(h.legacyMode=g)),a||ee(A,{outputEncoding:l?3e3:3001,toneMapping:u?Ft:It}),b.legacy!==g&&b.set(()=>({legacy:g})),b.linear!==l&&b.set(()=>({linear:l})),b.flat!==u&&b.set(()=>({flat:u})),o&&!I.fun(o)&&!dt(o)&&!I.equ(o,A,te)&&ee(A,o),p&&!b.events.handlers&&b.set({events:p(f)});const E=Mn(e,c);return I.equ(E,b.size,te)||b.setSize(E.width,E.height,E.updateStyle,E.top,E.left),C&&b.viewport.dpr!==ct(C)&&b.setDpr(C),b.frameloop!==O&&b.setFrameloop(O),b.onPointerMissed||b.set({onPointerMissed:L}),k&&!I.equ(k,b.performance,te)&&b.set(_=>({performance:{..._.performance,...k}})),m=M,a=!0,this},render(r){return a||this.configure(),ge.updateContainer(P.createElement(Cn,{store:f,children:r,onCreated:m,rootElement:e}),w,null,()=>{}),f},unmount(){yt(e)}}}function Cn({store:e,children:t,onCreated:n,rootElement:i}){return ce(()=>{const s=e.getState();s.set(f=>({internal:{...f.internal,active:!0}})),n&&n(s),e.getState().events.connected||s.events.connect==null||s.events.connect(i)},[]),P.createElement(pt.Provider,{value:e},t)}function yt(e,t){const n=ie.get(e),i=n==null?void 0:n.fiber;if(i){const s=n==null?void 0:n.store.getState();s&&(s.internal.active=!1),ge.updateContainer(null,i,null,()=>{s&&setTimeout(()=>{try{var f,w,m,a;s.events.disconnect==null||s.events.disconnect(),(f=s.gl)==null||(w=f.renderLists)==null||w.dispose==null||w.dispose(),(m=s.gl)==null||m.forceContextLoss==null||m.forceContextLoss(),(a=s.gl)!=null&&a.xr&&s.xr.disconnect(),un(s),ie.delete(e)}catch{}},500)})}}ge.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:P.version});const Re={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Sn(e){const{handlePointer:t}=mn(e);return{priority:1,enabled:!0,compute(n,i,s){i.pointer.set(n.offsetX/i.size.width*2-1,-(n.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(Re).reduce((n,i)=>({...n,[i]:t(i)}),{}),update:()=>{var n;const{events:i,internal:s}=e.getState();(n=s.lastEvent)!=null&&n.current&&i.handlers&&i.handlers.onPointerMove(s.lastEvent.current)},connect:n=>{var i;const{set:s,events:f}=e.getState();f.disconnect==null||f.disconnect(),s(w=>({events:{...w.events,connected:n}})),Object.entries((i=f.handlers)!=null?i:[]).forEach(([w,m])=>{const[a,v]=Re[w];n.addEventListener(a,m,{passive:v})})},disconnect:()=>{const{set:n,events:i}=e.getState();if(i.connected){var s;Object.entries((s=i.handlers)!=null?s:[]).forEach(([f,w])=>{if(i&&i.connected instanceof HTMLElement){const[m]=Re[f];i.connected.removeEventListener(m,w)}}),n(f=>({events:{...f.events,connected:void 0}}))}}}}const xn=P.forwardRef(function({children:t,fallback:n,resize:i,style:s,gl:f,events:w=Sn,eventSource:m,eventPrefix:a,shadows:v,linear:r,flat:o,legacy:c,orthographic:d,frameloop:p,dpr:M,performance:y,raycaster:l,camera:u,scene:g,onPointerMissed:S,onCreated:O,...C},k){P.useMemo(()=>rn(Gt),[]);const D=Yt(),[R,L]=Ut({scroll:!0,debounce:{scroll:50,resize:0},...i}),b=P.useRef(null),A=P.useRef(null);P.useImperativeHandle(k,()=>b.current);const B=st(S),[q,z]=P.useState(!1),[N,H]=P.useState(!1);if(q)throw q;if(N)throw N;const h=P.useRef(null);ce(()=>{const _=b.current;L.width>0&&L.height>0&&_&&(h.current||(h.current=En(_)),h.current.configure({gl:f,events:w,shadows:v,linear:r,flat:o,legacy:c,orthographic:d,frameloop:p,dpr:M,performance:y,raycaster:l,camera:u,scene:g,size:L,onPointerMissed:(...x)=>B.current==null?void 0:B.current(...x),onCreated:x=>{x.events.connect==null||x.events.connect(m?sn(m)?m.current:m:A.current),a&&x.setEvents({compute:(T,j)=>{const W=T[a+"X"],$=T[a+"Y"];j.pointer.set(W/j.size.width*2-1,-($/j.size.height)*2+1),j.raycaster.setFromCamera(j.pointer,j.camera)}}),O==null||O(x)}}),h.current.render(P.createElement(D,null,P.createElement(at,{set:H},P.createElement(P.Suspense,{fallback:P.createElement(an,{set:z})},t)))))}),P.useEffect(()=>{const _=b.current;if(_)return()=>yt(_)},[]);const E=m?"none":"auto";return P.createElement("div",Ae({ref:A,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:E,...s}},C),P.createElement("div",{ref:R,style:{width:"100%",height:"100%"}},P.createElement("canvas",{ref:b,style:{display:"block"}},n)))}),Zn=P.forwardRef(function(t,n){return P.createElement(Xt,null,P.createElement(xn,Ae({},t,{ref:n})))}),fe=new X,ze=new X,On=new X,et=new tt;function Rn(e,t,n){const i=fe.setFromMatrixPosition(e.matrixWorld);i.project(t);const s=n.width/2,f=n.height/2;return[i.x*s+s,-(i.y*f)+f]}function jn(e,t){const n=fe.setFromMatrixPosition(e.matrixWorld),i=ze.setFromMatrixPosition(t.matrixWorld),s=n.sub(i),f=t.getWorldDirection(On);return s.angleTo(f)>Math.PI/2}function Tn(e,t,n,i){const s=fe.setFromMatrixPosition(e.matrixWorld),f=s.clone();f.project(t),et.set(f.x,f.y),n.setFromCamera(et,t);const w=n.intersectObjects(i,!0);if(w.length){const m=w[0].distance;return s.distanceTo(n.ray.origin)<m}return!0}function kn(e,t){if(t instanceof De)return t.zoom;if(t instanceof Le){const n=fe.setFromMatrixPosition(e.matrixWorld),i=ze.setFromMatrixPosition(t.matrixWorld),s=t.fov*Math.PI/180,f=n.distanceTo(i);return 1/(2*Math.tan(s/2)*f)}else return 1}function An(e,t,n){if(t instanceof Le||t instanceof De){const i=fe.setFromMatrixPosition(e.matrixWorld),s=ze.setFromMatrixPosition(t.matrixWorld),f=i.distanceTo(s),w=(n[1]-n[0])/(t.far-t.near),m=n[1]-w*t.far;return Math.round(w*f+m)}}const ke=e=>Math.abs(e)<1e-10?0:e;function bt(e,t,n=""){let i="matrix3d(";for(let s=0;s!==16;s++)i+=ke(t[s]*e.elements[s])+(s!==15?",":")");return n+i}const Dn=(e=>t=>bt(t,e))([1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1]),Ln=(e=>(t,n)=>bt(t,e(n),"translate(-50%,-50%)"))(e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1]);function Fn(e){return e&&typeof e=="object"&&"current"in e}const Kn=P.forwardRef(({children:e,eps:t=.001,style:n,className:i,prepend:s,center:f,fullscreen:w,portal:m,distanceFactor:a,sprite:v=!1,transform:r=!1,occlude:o,onOcclude:c,castShadow:d,receiveShadow:p,material:M,geometry:y,zIndexRange:l=[16777271,0],calculatePosition:u=Rn,as:g="div",wrapperClass:S,pointerEvents:O="auto",...C},k)=>{const{gl:D,camera:R,scene:L,size:b,raycaster:A,events:B,viewport:q}=_n(),[z]=P.useState(()=>document.createElement(g)),N=P.useRef(),H=P.useRef(null),h=P.useRef(0),E=P.useRef([0,0]),_=P.useRef(null),x=P.useRef(null),T=(m==null?void 0:m.current)||B.connected||D.domElement.parentNode,j=P.useRef(null),W=P.useRef(!1),$=P.useMemo(()=>o&&o!=="blending"||Array.isArray(o)&&o.length&&Fn(o[0]),[o]);P.useLayoutEffect(()=>{const G=D.domElement;o&&o==="blending"?(G.style.zIndex=`${Math.floor(l[0]/2)}`,G.style.position="absolute",G.style.pointerEvents="none"):(G.style.zIndex=null,G.style.position=null,G.style.pointerEvents=null)},[o]),P.useLayoutEffect(()=>{if(H.current){const G=N.current=Kt(z);if(L.updateMatrixWorld(),r)z.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{const F=u(H.current,R,b);z.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${F[0]}px,${F[1]}px,0);transform-origin:0 0;`}return T&&(s?T.prepend(z):T.appendChild(z)),()=>{T&&T.removeChild(z),G.unmount()}}},[T,r]),P.useLayoutEffect(()=>{S&&(z.className=S)},[S]);const V=P.useMemo(()=>r?{position:"absolute",top:0,left:0,width:b.width,height:b.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:f?"translate3d(-50%,-50%,0)":"none",...w&&{top:-b.height/2,left:-b.width/2,width:b.width,height:b.height},...n},[n,f,w,b,r]),J=P.useMemo(()=>({position:"absolute",pointerEvents:O}),[O]);P.useLayoutEffect(()=>{if(W.current=!1,r){var G;(G=N.current)==null||G.render(P.createElement("div",{ref:_,style:V},P.createElement("div",{ref:x,style:J},P.createElement("div",{ref:k,className:i,style:n,children:e}))))}else{var F;(F=N.current)==null||F.render(P.createElement("div",{ref:k,style:V,className:i,children:e}))}});const Q=P.useRef(!0);ht(G=>{if(H.current){R.updateMatrixWorld(),H.current.updateWorldMatrix(!0,!1);const F=r?E.current:u(H.current,R,b);if(r||Math.abs(h.current-R.zoom)>t||Math.abs(E.current[0]-F[0])>t||Math.abs(E.current[1]-F[1])>t){const Y=jn(H.current,R);let U=!1;$&&(Array.isArray(o)?U=o.map(Z=>Z.current):o!=="blending"&&(U=[L]));const se=Q.current;if(U){const Z=Tn(H.current,R,A,U);Q.current=Z&&!Y}else Q.current=!Y;se!==Q.current&&(c?c(!Q.current):z.style.display=Q.current?"block":"none");const de=Math.floor(l[0]/2),Pt=o?$?[l[0],de]:[de-1,0]:l;if(z.style.zIndex=`${An(H.current,R,Pt)}`,r){const[Z,We]=[b.width/2,b.height/2],ye=R.projectionMatrix.elements[5]*We,{isOrthographicCamera:Ne,top:Mt,left:Et,bottom:Ct,right:St}=R,xt=Dn(R.matrixWorldInverse),Ot=Ne?`scale(${ye})translate(${ke(-(St+Et)/2)}px,${ke((Mt+Ct)/2)}px)`:`translateZ(${ye}px)`;let K=H.current.matrixWorld;v&&(K=R.matrixWorldInverse.clone().transpose().copyPosition(K).scale(H.current.scale),K.elements[3]=K.elements[7]=K.elements[11]=0,K.elements[15]=1),z.style.width=b.width+"px",z.style.height=b.height+"px",z.style.perspective=Ne?"":`${ye}px`,_.current&&x.current&&(_.current.style.transform=`${Ot}${xt}translate(${Z}px,${We}px)`,x.current.style.transform=Ln(K,1/((a||10)/400)))}else{const Z=a===void 0?1:kn(H.current,R)*a;z.style.transform=`translate3d(${F[0]}px,${F[1]}px,0) scale(${Z})`}E.current=F,h.current=R.zoom}}if(!$&&j.current&&!W.current)if(r){if(_.current){const F=_.current.children[0];if(F!=null&&F.clientWidth&&F!=null&&F.clientHeight){const{isOrthographicCamera:Y}=R;if(Y||y)C.scale&&(Array.isArray(C.scale)?C.scale instanceof X?j.current.scale.copy(C.scale.clone().divideScalar(1)):j.current.scale.set(1/C.scale[0],1/C.scale[1],1/C.scale[2]):j.current.scale.setScalar(1/C.scale));else{const U=(a||10)/400,se=F.clientWidth*U,de=F.clientHeight*U;j.current.scale.set(se,de,1)}W.current=!0}}}else{const F=z.children[0];if(F!=null&&F.clientWidth&&F!=null&&F.clientHeight){const Y=1/q.factor,U=F.clientWidth*Y,se=F.clientHeight*Y;j.current.scale.set(U,se,1),W.current=!0}j.current.lookAt(G.camera.position)}});const Be=P.useMemo(()=>({vertexShader:r?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[r]);return P.createElement("group",Ae({},C,{ref:H}),o&&!$&&P.createElement("mesh",{castShadow:d,receiveShadow:p,ref:j},y||P.createElement("planeGeometry",null),M||P.createElement("shaderMaterial",{side:qt,vertexShader:Be.vertexShader,fragmentShader:Be.fragmentShader})))});let me=null,wt="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function _t(e,t,n){return i=>{n&&n(i),e&&(me||(me=new Jt),me.setDecoderPath(typeof e=="string"?e:wt),i.setDRACOLoader(me)),t&&i.setMeshoptDecoder(typeof _e=="function"?_e():_e)}}function He(e,t=!0,n=!0,i){return ue(Fe,e,_t(t,n,i))}He.preload=(e,t=!0,n=!0,i)=>ue.preload(Fe,e,_t(t,n,i));He.clear=e=>ue.clear(Fe,e);He.setDecoderPath=e=>{wt=e};function Jn(e,t){const n=P.useRef(),[i]=P.useState(()=>t?t instanceof Ge?{current:t}:t:n),[s]=P.useState(()=>new Vt(void 0));P.useLayoutEffect(()=>{t&&(i.current=t instanceof Ge?t:t.current),s._root=i.current});const f=P.useRef({}),w=P.useMemo(()=>{const m={};return e.forEach(a=>Object.defineProperty(m,a.name,{enumerable:!0,get(){if(i.current)return f.current[a.name]||(f.current[a.name]=s.clipAction(a,i.current))},configurable:!0})),{ref:i,clips:e,actions:m,names:e.map(a=>a.name),mixer:s}},[e]);return ht((m,a)=>s.update(a)),P.useEffect(()=>{const m=i.current;return()=>{f.current={},s.stopAllAction(),Object.values(w.actions).forEach(a=>{m&&s.uncacheAction(a,m)})}},[e]),w}export{Zn as C,Kn as H,Yn as a,ee as b,Xn as c,He as d,ht as e,Jn as f,Un as g,_n as u};
